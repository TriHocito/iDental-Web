================================================================================
            GIáº¢I THÃCH Tá»ªNG DÃ’NG CODE: get_shifts_by_date.php
================================================================================

ğŸ“„ FILE: controllers/get_shifts_by_date.php
ğŸ¯ Má»¤C ÄÃCH: API kiá»ƒm tra lá»‹ch lÃ m viá»‡c cá»§a bÃ¡c sÄ© theo ngÃ y
ğŸ“¥ INPUT: GET ?id={id_bacsi}&date={YYYY-MM-DD}
ğŸ“¤ OUTPUT: JSON {status, shifts[], phone, day_name}

================================================================================
                        GIáº¢I THÃCH CHI TIáº¾T Tá»ªNG DÃ’NG
================================================================================

DÃ’NG 1-2: KHá»I Táº O
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
<?php
require '../config/db_connect.php';

â†’ DÃ²ng 1: Má»Ÿ tag PHP Ä‘á»ƒ viáº¿t code PHP
â†’ DÃ²ng 2: Include file káº¿t ná»‘i database
          â€¢ File db_connect.php chá»©a biáº¿n $conn (PDO connection)
          â€¢ Tá»« folder controllers/ lÃ¹i 1 cáº¥p (..) vÃ o folder config/


DÃ’NG 4: SET HEADER JSON
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
header('Content-Type: application/json');

â†’ BÃ¡o cho browser biáº¿t response sáº½ tráº£ vá» dáº¡ng JSON
â†’ Quan trá»ng Ä‘á»ƒ JavaScript cÃ³ thá»ƒ parse JSON chÃ­nh xÃ¡c
â†’ Náº¿u thiáº¿u dÃ²ng nÃ y, browser cÃ³ thá»ƒ hiá»ƒu nháº§m lÃ  text/html


DÃ’NG 6: KIá»‚M TRA THAM Sá» Äáº¦U VÃ€O
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if (isset($_GET['id']) && isset($_GET['date'])) {

â†’ Kiá»ƒm tra 2 tham sá»‘ báº¯t buá»™c cÃ³ tá»“n táº¡i khÃ´ng:
  â€¢ $_GET['id']: ID cá»§a bÃ¡c sÄ© (VD: ?id=2)
  â€¢ $_GET['date']: NgÃ y cáº§n check (VD: &date=2025-12-25)
â†’ Náº¿u thiáº¿u 1 trong 2 â†’ Code trong {} KHÃ”NG cháº¡y, file káº¿t thÃºc


DÃ’NG 7-8: Láº¤Y GIÃ TRá»Š THAM Sá»
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    $id_bacsi = $_GET['id'];
    $date = $_GET['date']; // YYYY-MM-DD

â†’ DÃ²ng 7: LÆ°u ID bÃ¡c sÄ© vÃ o biáº¿n $id_bacsi (VD: 2, 3, 4)
â†’ DÃ²ng 8: LÆ°u ngÃ y vÃ o biáº¿n $date (Format: 2025-12-25)
          â€¢ Comment ghi chÃº format Ä‘á»ƒ dev nhá»›


DÃ’NG 10: Báº®T Äáº¦U BLOCK TRY-CATCH
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    try {

â†’ Báº¯t Ä‘áº§u khá»‘i try Ä‘á»ƒ báº¯t lá»—i (error handling)
â†’ Náº¿u cÃ³ lá»—i SQL hoáº·c lá»—i khÃ¡c â†’ Nháº£y xuá»‘ng block catch


DÃ’NG 11-14: Láº¤Y Sá» ÄIá»†N THOáº I BÃC SÄ¨
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // 1. Láº¥y thÃ´ng tin cÆ¡ báº£n
        $stmt_info = $conn->prepare("SELECT sdt FROM bacsi WHERE id_bacsi = ?");
        $stmt_info->execute([$id_bacsi]);
        $doc = $stmt_info->fetch(PDO::FETCH_ASSOC);

â†’ DÃ²ng 11: Comment mÃ´ táº£ logic
â†’ DÃ²ng 12: Chuáº©n bá»‹ cÃ¢u SQL vá»›i Prepared Statement
           â€¢ ? lÃ  placeholder Ä‘á»ƒ trÃ¡nh SQL Injection
           â€¢ Láº¥y cá»™t 'sdt' (sá»‘ Ä‘iá»‡n thoáº¡i) tá»« báº£ng 'bacsi'
â†’ DÃ²ng 13: Thá»±c thi query, truyá»n $id_bacsi vÃ o placeholder
           â€¢ [$id_bacsi] tá»± Ä‘á»™ng bind vÃ o vá»‹ trÃ­ ?
â†’ DÃ²ng 14: Láº¥y káº¿t quáº£ dÆ°á»›i dáº¡ng array associative
           â€¢ $doc = ['sdt' => '0912345678']


DÃ’NG 15: Xá»¬ LÃ TRÆ¯á»œNG Há»¢P KHÃ”NG TÃŒM THáº¤Y
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        $phone = $doc['sdt'] ?? 'Tá»•ng Ä‘Ã i';

â†’ ToÃ¡n tá»­ ?? (Null Coalescing Operator):
  â€¢ Náº¿u $doc['sdt'] Tá»’N Táº I vÃ  KHÃ”NG NULL â†’ $phone = giÃ¡ trá»‹ Ä‘Ã³
  â€¢ Náº¿u $doc['sdt'] KHÃ”NG Tá»’N Táº I hoáº·c NULL â†’ $phone = 'Tá»•ng Ä‘Ã i'
â†’ Äáº£m báº£o luÃ´n cÃ³ giÃ¡ trá»‹, trÃ¡nh lá»—i undefined index


DÃ’NG 17: TÃNH NGÃ€Y TRONG TUáº¦N
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        $day_of_week = date('N', strtotime($date));

â†’ strtotime($date): Chuyá»ƒn string ngÃ y thÃ nh Unix timestamp
  â€¢ VD: "2025-12-25" â†’ 1735084800
â†’ date('N', ...): Láº¥y sá»‘ thá»© trong tuáº§n (1-7)
  â€¢ 1 = Thá»© 2, 2 = Thá»© 3, ..., 7 = Chá»§ Nháº­t
â†’ Káº¿t quáº£: $day_of_week = 4 (náº¿u lÃ  Thá»© 5)


DÃ’NG 19-21: MAP Sá» THÃ€NH TÃŠN THá»¨
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // HÃ m há»— trá»£ láº¥y tÃªn thá»©
        $days_map = [1=>'Thá»© 2', 2=>'Thá»© 3', 3=>'Thá»© 4', 4=>'Thá»© 5', 
                     5=>'Thá»© 6', 6=>'Thá»© 7', 7=>'Chá»§ Nháº­t'];
        $day_name = $days_map[$day_of_week] ?? '';

â†’ DÃ²ng 20: Táº¡o array Ã¡nh xáº¡ sá»‘ â†’ tÃªn
           â€¢ Key = sá»‘ (1-7), Value = tÃªn thá»©
â†’ DÃ²ng 21: Láº¥y tÃªn thá»© tá»« array
           â€¢ VD: $day_of_week = 4 â†’ $day_name = 'Thá»© 5'
           â€¢ Náº¿u khÃ´ng tÃ¬m tháº¥y â†’ $day_name = '' (chuá»—i rá»—ng)


DÃ’NG 23-25: CHUáº¨N Bá»Š QUERY KIá»‚M TRA NGHá»ˆ PHÃ‰P
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // 2. [LOGIC 1] Kiá»ƒm tra ngÃ y nghá»‰ (Æ¯u tiÃªn cao nháº¥t)
        $sql_leave = "SELECT ca_nghi FROM yeucaunghi 
                      WHERE id_bacsi = ? AND ngay_nghi = ? AND trang_thai = 'da_duyet'";

â†’ DÃ²ng 23: Comment logic Æ°u tiÃªn
â†’ DÃ²ng 24-25: CÃ¢u SQL kiá»ƒm tra nghá»‰ phÃ©p
  â€¢ Báº£ng: yeucaunghi (yÃªu cáº§u nghá»‰)
  â€¢ Äiá»u kiá»‡n:
    1. id_bacsi = ? (BÃ¡c sÄ© cá»¥ thá»ƒ)
    2. ngay_nghi = ? (ÄÃºng ngÃ y Ä‘ang check)
    3. trang_thai = 'da_duyet' (ÄÃ£ Ä‘Æ°á»£c admin duyá»‡t)
  â€¢ Náº¿u tÃ¬m tháº¥y â†’ BÃ¡c sÄ© NGHá»ˆ ngÃ y nÃ y


DÃ’NG 26-27: THá»°C THI QUERY NGHá»ˆ PHÃ‰P
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        $stmt_leave = $conn->prepare($sql_leave);
        $stmt_leave->execute([$id_bacsi, $date]);

â†’ DÃ²ng 26: Chuáº©n bá»‹ cÃ¢u SQL (2 placeholder ?)
â†’ DÃ²ng 27: Thá»±c thi vá»›i 2 tham sá»‘:
  â€¢ $id_bacsi vÃ o ? thá»© nháº¥t
  â€¢ $date vÃ o ? thá»© hai


DÃ’NG 29-35: Xá»¬ LÃ Náº¾U BÃC SÄ¨ NGHá»ˆ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if ($stmt_leave->rowCount() > 0) {
            echo json_encode([
                'status' => 'on_leave',
                'phone' => $phone,
                'day_name' => $day_name
            ]);
            exit;
        }

â†’ DÃ²ng 29: Kiá»ƒm tra sá»‘ dÃ²ng tráº£ vá»
  â€¢ rowCount() > 0 â†’ CÃ“ báº£n ghi â†’ BÃ¡c sÄ© NGHá»ˆ
â†’ DÃ²ng 30-34: Tráº£ vá» JSON:
  â€¢ 'status' => 'on_leave': Tráº¡ng thÃ¡i nghá»‰ phÃ©p
  â€¢ 'phone' => $phone: SÄT bÃ¡c sÄ© (hoáº·c 'Tá»•ng Ä‘Ã i')
  â€¢ 'day_name' => $day_name: TÃªn thá»© (VD: 'Thá»© 5')
â†’ DÃ²ng 35: exit; â†’ Dá»«ng script, KHÃ”NG cháº¡y code phÃ­a dÆ°á»›i


DÃ’NG 37-42: CHUáº¨N Bá»Š QUERY Lá»ŠCH LÃ€M VIá»†C
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // 3. [LOGIC 2] Kiá»ƒm tra ca lÃ m viá»‡c
        // Chá»‰ láº¥y lá»‹ch cá»§a Ä‘Ãºng ngÃ y Ä‘Ã³ (ngay_hieu_luc = ?)
        $sql_schedule = "SELECT DISTINCT gio_bat_dau 
                         FROM lichlamviec 
                         WHERE id_bacsi = ? 
                         AND ngay_hieu_luc = ? 
                         ORDER BY gio_bat_dau ASC";

â†’ DÃ²ng 37-38: Comment logic thá»© 2
â†’ DÃ²ng 39-42: CÃ¢u SQL láº¥y lá»‹ch lÃ m viá»‡c
  â€¢ SELECT DISTINCT gio_bat_dau: Láº¥y giá» báº¯t Ä‘áº§u, loáº¡i bá» trÃ¹ng
  â€¢ FROM lichlamviec: Tá»« báº£ng lá»‹ch lÃ m viá»‡c
  â€¢ WHERE:
    - id_bacsi = ? (BÃ¡c sÄ© cá»¥ thá»ƒ)
    - ngay_hieu_luc = ? (ÄÃºng ngÃ y Ä‘ang check)
  â€¢ ORDER BY gio_bat_dau ASC: Sáº¯p xáº¿p theo giá» tÄƒng dáº§n
    (08:00 trÆ°á»›c, 13:00 sau)


DÃ’NG 44-46: THá»°C THI QUERY Lá»ŠCH LÃ€M VIá»†C
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        $stmt = $conn->prepare($sql_schedule);
        $stmt->execute([$id_bacsi, $date]);
        $shifts = $stmt->fetchAll(PDO::FETCH_ASSOC);

â†’ DÃ²ng 44: Chuáº©n bá»‹ cÃ¢u SQL
â†’ DÃ²ng 45: Thá»±c thi vá»›i 2 tham sá»‘
â†’ DÃ²ng 46: Láº¥y Táº¤T Cáº¢ káº¿t quáº£ dÆ°á»›i dáº¡ng array
  â€¢ VD: $shifts = [
      ['gio_bat_dau' => '08:00:00'],
      ['gio_bat_dau' => '13:00:00']
    ]
  â€¢ Náº¿u khÃ´ng cÃ³ â†’ $shifts = []


DÃ’NG 48: KHá»I Táº O Máº¢NG Káº¾T QUáº¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        $available_shifts = [];

â†’ Táº¡o máº£ng rá»—ng Ä‘á»ƒ chá»©a danh sÃ¡ch ca lÃ m viá»‡c
â†’ Sáº½ Ä‘Æ°á»£c fill trong vÃ²ng láº·p bÃªn dÆ°á»›i


DÃ’NG 49-60: Xá»¬ LÃ Dá»® LIá»†U CA LÃ€M VIá»†C
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if (!empty($shifts)) {
            foreach ($shifts as $sch) {
                $hour = date('H', strtotime($sch['gio_bat_dau']));
                $shift_code = ($hour < 12) ? 'Sang' : 'Chieu';
                $shift_label = ($hour < 12) ? 'SÃ¡ng (08:00 - 12:00)' : 'Chiá»u (13:00 - 17:00)';
                
                $available_shifts[] = [
                    'value' => $shift_code,
                    'label' => $shift_label
                ];
            }
        }

â†’ DÃ²ng 49: Kiá»ƒm tra máº£ng $shifts cÃ³ dá»¯ liá»‡u khÃ´ng
  â€¢ !empty($shifts) â†’ TRUE náº¿u cÃ³ Ã­t nháº¥t 1 ca
â†’ DÃ²ng 50: Láº·p qua tá»«ng ca trong $shifts
  â€¢ $sch = ['gio_bat_dau' => '08:00:00']
â†’ DÃ²ng 51: Láº¥y giá» tá»« time
  â€¢ strtotime('08:00:00') â†’ timestamp
  â€¢ date('H', ...) â†’ '08' (chá»‰ láº¥y giá»)
â†’ DÃ²ng 52: XÃ¡c Ä‘á»‹nh ca SÃ¡ng hay Chiá»u
  â€¢ Ternary operator: (Ä‘iá»u kiá»‡n) ? giÃ¡ trá»‹_náº¿u_Ä‘Ãºng : giÃ¡ trá»‹_náº¿u_sai
  â€¢ Náº¿u giá» < 12 â†’ 'Sang'
  â€¢ Náº¿u giá» >= 12 â†’ 'Chieu'
â†’ DÃ²ng 53: Táº¡o label hiá»ƒn thá»‹ cho user
  â€¢ SÃ¡ng: 'SÃ¡ng (08:00 - 12:00)'
  â€¢ Chiá»u: 'Chiá»u (13:00 - 17:00)'
â†’ DÃ²ng 55-58: ThÃªm vÃ o máº£ng káº¿t quáº£
  â€¢ [] syntax: ThÃªm pháº§n tá»­ má»›i vÃ o cuá»‘i array
  â€¢ Má»—i pháº§n tá»­ lÃ  1 array con vá»›i 2 key:
    - 'value': GiÃ¡ trá»‹ gá»­i lÃªn server ('Sang'/'Chieu')
    - 'label': Text hiá»ƒn thá»‹ cho user


DÃ’NG 62-79: TRáº¢ Vá»€ Káº¾T QUáº¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // 4. Tráº£ káº¿t quáº£
        if (count($available_shifts) > 0) {
            // CÃ³ ca lÃ m
            echo json_encode([
                'status' => 'has_schedule',
                'shifts' => $available_shifts,
                'phone'  => $phone,
                'day_name' => $day_name 
            ]);
        } else {
            // KhÃ´ng cÃ³ ca
            echo json_encode([
                'status' => 'no_schedule',
                'phone'  => $phone,
                'day_name' => $day_name
            ]);
        }

â†’ DÃ²ng 63: Kiá»ƒm tra máº£ng ca cÃ³ dá»¯ liá»‡u khÃ´ng
  â€¢ count($available_shifts) > 0 â†’ CÃ“ Ã­t nháº¥t 1 ca
â†’ DÃ²ng 64-70: TH CÃ“ CA LÃ€M VIá»†C
  â€¢ json_encode(): Chuyá»ƒn array PHP â†’ JSON string
  â€¢ 'status' => 'has_schedule': Tráº¡ng thÃ¡i cÃ³ lá»‹ch
  â€¢ 'shifts' => $available_shifts: Máº£ng cÃ¡c ca
    VD: [
      {"value":"Sang","label":"SÃ¡ng (08:00 - 12:00)"},
      {"value":"Chieu","label":"Chiá»u (13:00 - 17:00)"}
    ]
  â€¢ 'phone': SÄT bÃ¡c sÄ©
  â€¢ 'day_name': TÃªn thá»©
â†’ DÃ²ng 71-77: TH KHÃ”NG CÃ“ CA
  â€¢ 'status' => 'no_schedule': KhÃ´ng cÃ³ lá»‹ch lÃ m viá»‡c
  â€¢ KhÃ´ng cÃ³ key 'shifts' (hoáº·c cÃ³ thá»ƒ thÃªm shifts: [])


DÃ’NG 79-81: Báº®T Lá»–I (CATCH BLOCK)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    } catch (Exception $e) {
        echo json_encode(['status' => 'error', 'message' => $e->getMessage()]);
    }

â†’ DÃ²ng 79: Náº¿u cÃ³ lá»—i trong block try, code nháº£y vÃ o Ä‘Ã¢y
  â€¢ $e lÃ  object Exception chá»©a thÃ´ng tin lá»—i
â†’ DÃ²ng 80: Tráº£ vá» JSON lá»—i
  â€¢ 'status' => 'error': Tráº¡ng thÃ¡i lá»—i
  â€¢ 'message' => $e->getMessage(): Chi tiáº¿t lá»—i
    VD: "SQLSTATE[42S02]: Base table or view not found"


DÃ’NG 82-83: ÄÃ“NG IF & PHP TAG
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
}
?>

â†’ DÃ²ng 82: ÄÃ³ng if (isset($_GET['id']) && isset($_GET['date']))
  â€¢ Náº¿u thiáº¿u tham sá»‘ â†’ Code bÃªn trong KHÃ”NG cháº¡y
  â€¢ File tráº£ vá» rá»—ng (khÃ´ng cÃ³ output)
â†’ DÃ²ng 83: ÄÃ³ng tag PHP


================================================================================
                        TÃ“M Táº®T LUá»’NG LOGIC
================================================================================

1ï¸âƒ£ Kiá»ƒm tra tham sá»‘ Ä‘áº§u vÃ o (id, date)
   â””â”€ Thiáº¿u â†’ KhÃ´ng lÃ m gÃ¬, káº¿t thÃºc

2ï¸âƒ£ Láº¥y thÃ´ng tin bÃ¡c sÄ© (SÄT)
   â””â”€ Query báº£ng 'bacsi'

3ï¸âƒ£ Kiá»ƒm tra nghá»‰ phÃ©p (Æ¯u tiÃªn cao)
   â””â”€ Query báº£ng 'yeucaunghi'
   â””â”€ CÃ³ nghá»‰? â†’ Return {"status":"on_leave"} â†’ EXIT

4ï¸âƒ£ Kiá»ƒm tra lá»‹ch lÃ m viá»‡c (Náº¿u khÃ´ng nghá»‰)
   â””â”€ Query báº£ng 'lichlamviec'
   â””â”€ Láº¥y táº¥t cáº£ ca lÃ m trong ngÃ y

5ï¸âƒ£ Xá»­ lÃ½ dá»¯ liá»‡u ca
   â””â”€ Convert time â†’ XÃ¡c Ä‘á»‹nh SÃ¡ng/Chiá»u
   â””â”€ Táº¡o array {value, label}

6ï¸âƒ£ Tráº£ káº¿t quáº£ JSON
   â”œâ”€ CÃ³ ca â†’ {"status":"has_schedule", "shifts":[...]}
   â””â”€ KhÃ´ng ca â†’ {"status":"no_schedule"}

7ï¸âƒ£ Báº¯t lá»—i (náº¿u cÃ³)
   â””â”€ Return {"status":"error", "message":"..."}


================================================================================
                        VÃ Dá»¤ THá»°C Táº¾
================================================================================

REQUEST:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET /controllers/get_shifts_by_date.php?id=2&date=2025-12-25


Xá»¬ LÃ:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ $id_bacsi = 2
â€¢ $date = '2025-12-25'
â€¢ $day_of_week = 4 (Thá»© 5)
â€¢ $day_name = 'Thá»© 5'

Check nghá»‰ phÃ©p:
  SELECT * FROM yeucaunghi 
  WHERE id_bacsi=2 AND ngay_nghi='2025-12-25' AND trang_thai='da_duyet'
  â†’ Káº¿t quáº£: 0 dÃ²ng (KhÃ´ng nghá»‰)

Check lá»‹ch lÃ m viá»‡c:
  SELECT gio_bat_dau FROM lichlamviec
  WHERE id_bacsi=2 AND ngay_hieu_luc='2025-12-25'
  â†’ Káº¿t quáº£: ['08:00:00', '13:00:00']

Xá»­ lÃ½:
  â€¢ '08:00:00' â†’ hour=08 â†’ 'Sang' â†’ 'SÃ¡ng (08:00 - 12:00)'
  â€¢ '13:00:00' â†’ hour=13 â†’ 'Chieu' â†’ 'Chiá»u (13:00 - 17:00)'


RESPONSE JSON:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{
  "status": "has_schedule",
  "shifts": [
    {
      "value": "Sang",
      "label": "SÃ¡ng (08:00 - 12:00)"
    },
    {
      "value": "Chieu",
      "label": "Chiá»u (13:00 - 17:00)"
    }
  ],
  "phone": "0912345678",
  "day_name": "Thá»© 5"
}


================================================================================
                        CÃC TRÆ¯á»œNG Há»¢P Äáº¶C BIá»†T
================================================================================

ğŸ“Œ TH1: Thiáº¿u tham sá»‘ (id hoáº·c date)
   â†’ Code trong if KHÃ”NG cháº¡y
   â†’ Response: (Rá»—ng, khÃ´ng cÃ³ gÃ¬)

ğŸ“Œ TH2: BÃ¡c sÄ© khÃ´ng tá»“n táº¡i
   â†’ $doc = false
   â†’ $phone = 'Tá»•ng Ä‘Ã i' (nhá» toÃ¡n tá»­ ??)

ğŸ“Œ TH3: BÃ¡c sÄ© nghá»‰ phÃ©p
   â†’ rowCount() > 0
   â†’ Return {"status":"on_leave"}
   â†’ exit; (KhÃ´ng cháº¡y code check lá»‹ch lÃ m viá»‡c)

ğŸ“Œ TH4: KhÃ´ng cÃ³ lá»‹ch lÃ m viá»‡c
   â†’ $shifts = []
   â†’ $available_shifts = []
   â†’ Return {"status":"no_schedule"}

ğŸ“Œ TH5: CÃ³ lá»—i SQL
   â†’ Nháº£y vÃ o catch block
   â†’ Return {"status":"error", "message":"..."}


================================================================================
                        ÄIá»‚M QUAN TRá»ŒNG
================================================================================

âœ“ Sá»­ dá»¥ng Prepared Statements â†’ TrÃ¡nh SQL Injection
âœ“ Kiá»ƒm tra nghá»‰ phÃ©p TRÆ¯á»šC lá»‹ch lÃ m viá»‡c â†’ Logic Æ°u tiÃªn Ä‘Ãºng
âœ“ Sá»­ dá»¥ng try-catch â†’ Xá»­ lÃ½ lá»—i an toÃ n
âœ“ Tráº£ vá» JSON vá»›i Content-Type header â†’ JavaScript parse Ä‘Æ°á»£c
âœ“ ToÃ¡n tá»­ ?? â†’ TrÃ¡nh lá»—i undefined index
âœ“ DISTINCT trong SQL â†’ Loáº¡i bá» giá» trÃ¹ng láº·p
âœ“ exit; sau return JSON nghá»‰ phÃ©p â†’ KhÃ´ng cháº¡y code thá»«a

================================================================================
