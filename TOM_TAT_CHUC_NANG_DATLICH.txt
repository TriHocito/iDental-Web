================================================================================
                    TÃ“M Táº®T CHá»¨C NÄ‚NG Äáº¶T Lá»ŠCH - DATLICH.PHP
================================================================================

ğŸ¯ Má»¤C ÄÃCH: KhÃ¡ch CHÆ¯A cÃ³ tÃ i khoáº£n Ä‘áº·t lá»‹ch khÃ¡m nha khoa online

================================================================================
                            CÃC FILE LIÃŠN QUAN
================================================================================

ğŸ“„ views/datlich.php
   â†’ Form Ä‘áº·t lá»‹ch (HTML + JavaScript AJAX)
   â†’ Hiá»ƒn thá»‹ dropdown: Dá»‹ch vá»¥, BÃ¡c sÄ©, NgÃ y, Ca

ğŸ“„ controllers/get_shifts_by_date.php  
   â†’ API kiá»ƒm tra lá»‹ch lÃ m viá»‡c cá»§a bÃ¡c sÄ©
   â†’ Tráº£ vá» JSON: status + danh sÃ¡ch ca

ğŸ“„ controllers/book_appointment.php
   â†’ Xá»­ lÃ½ Ä‘áº·t lá»‹ch chÃ­nh
   â†’ Táº¡o tÃ i khoáº£n + Táº¡o lá»‹ch háº¹n + Gá»­i email

ğŸ“„ includes/send_mail.php
   â†’ Gá»­i email thÃ´ng bÃ¡o (PHPMailer)
   â†’ Function: sendNewAccountInfo(), sendAppointmentConfirmation()

================================================================================
                        LUá»’NG HOáº T Äá»˜NG CHI TIáº¾T
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BÆ¯á»šC 1: HIá»‚N THá»Š FORM (datlich.php - PHP)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Code:                                                                   â”‚
â”‚   $services = $conn->query("SELECT * FROM dichvu")->fetchAll();        â”‚
â”‚   $doctors = $conn->query("SELECT * FROM bacsi")->fetchAll();          â”‚
â”‚                                                                         â”‚
â”‚ â†’ Load danh sÃ¡ch dá»‹ch vá»¥ vÃ  bÃ¡c sÄ© tá»« database                         â”‚
â”‚ â†’ Hiá»ƒn thá»‹ form vá»›i cÃ¡c trÆ°á»ng input                                    â”‚
â”‚ â†’ NgÃ y khÃ¡m vÃ  Ca khÃ¡m: DISABLED ban Ä‘áº§u                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BÆ¯á»šC 2: USER CHá»ŒN BÃC SÄ¨ (datlich.php - JavaScript)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Code:                                                                   â”‚
â”‚   docSelect.addEventListener('change', function() {                     â”‚
â”‚       if (this.value) {                                                 â”‚
â”‚           dateInput.disabled = false;  // Má»Ÿ khÃ³a chá»n ngÃ y             â”‚
â”‚       }                                                                 â”‚
â”‚   });                                                                   â”‚
â”‚                                                                         â”‚
â”‚ â†’ Khi user chá»n bÃ¡c sÄ©                                                  â”‚
â”‚ â†’ JavaScript má»Ÿ khÃ³a input "NgÃ y khÃ¡m"                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BÆ¯á»šC 3: USER CHá»ŒN NGÃ€Y - Gá»ŒI AJAX (datlich.php - JavaScript)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Code:                                                                   â”‚
â”‚   async function checkSchedule() {                                      â”‚
â”‚       const res = await fetch(                                          â”‚
â”‚           `get_shifts_by_date.php?id=${docId}&date=${dateVal}`          â”‚
â”‚       );                                                                â”‚
â”‚       const data = await res.json();                                    â”‚
â”‚       // Xá»­ lÃ½ 3 trÆ°á»ng há»£p...                                          â”‚
â”‚   }                                                                     â”‚
â”‚                                                                         â”‚
â”‚ â†’ AJAX call Ä‘áº¿n API get_shifts_by_date.php                             â”‚
â”‚ â†’ Gá»­i: id_bacsi + date                                                  â”‚
â”‚ â†’ Nháº­n: JSON response                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BÆ¯á»šC 4: KIá»‚M TRA Lá»ŠCH (get_shifts_by_date.php - PHP)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Code:                                                                   â”‚
â”‚   // 1. Check nghá»‰ phÃ©p                                                â”‚
â”‚   $stmt = $conn->prepare(                                               â”‚
â”‚       "SELECT ca_nghi FROM yeucaunghi                                   â”‚
â”‚        WHERE id_bacsi=? AND ngay_nghi=? AND trang_thai='da_duyet'"     â”‚
â”‚   );                                                                    â”‚
â”‚   if ($stmt->rowCount() > 0) {                                          â”‚
â”‚       return json: {"status": "on_leave"}                               â”‚
â”‚   }                                                                     â”‚
â”‚                                                                         â”‚
â”‚   // 2. Check lá»‹ch lÃ m viá»‡c                                            â”‚
â”‚   $stmt = $conn->prepare(                                               â”‚
â”‚       "SELECT gio_bat_dau FROM lichlamviec                              â”‚
â”‚        WHERE id_bacsi=? AND ngay_hieu_luc=?"                            â”‚
â”‚   );                                                                    â”‚
â”‚   if (cÃ³ lá»‹ch) {                                                        â”‚
â”‚       return json: {"status":"has_schedule", "shifts":[...]}            â”‚
â”‚   } else {                                                              â”‚
â”‚       return json: {"status":"no_schedule"}                             â”‚
â”‚   }                                                                     â”‚
â”‚                                                                         â”‚
â”‚ â†’ Kiá»ƒm tra 2 bÆ°á»›c: Nghá»‰ phÃ©p â†’ Lá»‹ch lÃ m viá»‡c                          â”‚
â”‚ â†’ Tráº£ vá» JSON vá»›i status tÆ°Æ¡ng á»©ng                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BÆ¯á»šC 5: Xá»¬ LÃ RESPONSE - HIá»‚N THá»Š CA (datlich.php - JavaScript)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Code:                                                                   â”‚
â”‚   if (data.status === 'on_leave') {                                     â”‚
â”‚       // Hiá»ƒn thá»‹ alert Ä‘á», disable dropdown ca                         â”‚
â”‚   } else if (data.status === 'has_schedule') {                          â”‚
â”‚       // Hiá»ƒn thá»‹ ca tá»« data.shifts[]                                   â”‚
â”‚       data.shifts.forEach(shift => {                                    â”‚
â”‚           let opt = document.createElement('option');                   â”‚
â”‚           opt.value = shift.value; // "Sang" hoáº·c "Chieu"              â”‚
â”‚           shiftSelect.appendChild(opt);                                 â”‚
â”‚       });                                                               â”‚
â”‚   } else {                                                              â”‚
â”‚       // Hiá»ƒn thá»‹ alert vÃ ng + 2 ca dá»± kiáº¿n (SÃ¡ng/Chiá»u)               â”‚
â”‚   }                                                                     â”‚
â”‚                                                                         â”‚
â”‚ â†’ Xá»­ lÃ½ 3 trÆ°á»ng há»£p tá»« JSON response                                   â”‚
â”‚ â†’ Hiá»ƒn thá»‹ dropdown Ca phÃ¹ há»£p                                          â”‚
â”‚ â†’ Má»Ÿ khÃ³a nÃºt Submit khi user chá»n ca                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BÆ¯á»šC 6: USER SUBMIT FORM (datlich.php â†’ book_appointment.php)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Code HTML:                                                              â”‚
â”‚   <form action="../controllers/book_appointment.php" method="POST">     â”‚
â”‚       <input name="fullname">                                           â”‚
â”‚       <input name="phone">                                              â”‚
â”‚       <input name="email">                                              â”‚
â”‚       <select name="id_dichvu">                                         â”‚
â”‚       <select name="id_bacsi">                                          â”‚
â”‚       <input name="date">                                               â”‚
â”‚       <select name="shift">  // "Sang" hoáº·c "Chieu"                    â”‚
â”‚   </form>                                                               â”‚
â”‚                                                                         â”‚
â”‚ â†’ User Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin                                            â”‚
â”‚ â†’ Click "Gá»­i YÃªu Cáº§u"                                                   â”‚
â”‚ â†’ Form POST Ä‘áº¿n book_appointment.php                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BÆ¯á»šC 7: Xá»¬ LÃ Äáº¶T Lá»ŠCH (book_appointment.php - PHP)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Code:                                                                   â”‚
â”‚   // 1. Check tÃ i khoáº£n Ä‘Ã£ tá»“n táº¡i                                     â”‚
â”‚   $check = $conn->prepare(                                              â”‚
â”‚       "SELECT id_benhnhan FROM benhnhan WHERE sdt=? OR email=?"         â”‚
â”‚   );                                                                    â”‚
â”‚   if ($check->rowCount() > 0) {                                         â”‚
â”‚       alert("TÃ i khoáº£n Ä‘Ã£ tá»“n táº¡i! Vui lÃ²ng Ä‘Äƒng nháº­p");               â”‚
â”‚       exit();                                                           â”‚
â”‚   }                                                                     â”‚
â”‚                                                                         â”‚
â”‚   // 2. Check nghá»‰ phÃ©p (Cháº·n tuyá»‡t Ä‘á»‘i)                               â”‚
â”‚   $stmt = $conn->prepare(                                               â”‚
â”‚       "SELECT * FROM yeucaunghi                                         â”‚
â”‚        WHERE id_bacsi=? AND ngay_nghi=? AND trang_thai='da_duyet'"     â”‚
â”‚   );                                                                    â”‚
â”‚   if ($stmt->rowCount() > 0) {                                          â”‚
â”‚       alert("BÃ¡c sÄ© Ä‘Ã£ nghá»‰ phÃ©p");                                    â”‚
â”‚       exit();                                                           â”‚
â”‚   }                                                                     â”‚
â”‚                                                                         â”‚
â”‚   // 3. Check lá»‹ch lÃ m viá»‡c & TÃ­nh giá»                                 â”‚
â”‚   $start_hour = ($shift == 'Sang') ? '08:00:00' : '13:00:00';          â”‚
â”‚   $stmt = $conn->prepare(                                               â”‚
â”‚       "SELECT * FROM lichlamviec                                        â”‚
â”‚        WHERE id_bacsi=? AND gio_bat_dau=? AND ngay_hieu_luc=?"         â”‚
â”‚   );                                                                    â”‚
â”‚                                                                         â”‚
â”‚   if ($stmt->rowCount() > 0) {                                          â”‚
â”‚       // CÃ“ Lá»ŠCH: TÃ­nh giá» chÃ­nh xÃ¡c (Queue System)                    â”‚
â”‚       // Láº¥y lá»‹ch háº¹n cuá»‘i cÃ¹ng trong ca                                â”‚
â”‚       // Cá»™ng thÃªm thá»i gian dá»‹ch vá»¥                                    â”‚
â”‚       $final_datetime = /* Giá» tÃ­nh toÃ¡n */;                            â”‚
â”‚   } else {                                                              â”‚
â”‚       // KHÃ”NG CÃ“ Lá»ŠCH: Giá» táº¡m thá»i                                   â”‚
â”‚       $final_datetime = "$date $start_hour";                            â”‚
â”‚   }                                                                     â”‚
â”‚                                                                         â”‚
â”‚   // 4. Táº¡o tÃ i khoáº£n tá»± Ä‘á»™ng                                          â”‚
â”‚   $conn->beginTransaction();                                            â”‚
â”‚   $rand_pass = rand(100000, 999999);                                   â”‚
â”‚   $pass_hash = password_hash($rand_pass, PASSWORD_DEFAULT);            â”‚
â”‚                                                                         â”‚
â”‚   $stmt = $conn->prepare(                                               â”‚
â”‚       "INSERT INTO benhnhan (sdt, email, mat_khau_hash, ten_day_du)    â”‚
â”‚        VALUES (?, ?, ?, ?)"                                             â”‚
â”‚   );                                                                    â”‚
â”‚   $stmt->execute([$phone, $email, $pass_hash, $fullname]);             â”‚
â”‚   $user_id = $conn->lastInsertId();                                     â”‚
â”‚                                                                         â”‚
â”‚   // 5. Táº¡o lá»‹ch háº¹n                                                   â”‚
â”‚   $stmt = $conn->prepare(                                               â”‚
â”‚       "INSERT INTO lichhen                                              â”‚
â”‚        (id_benhnhan, id_bacsi, id_dichvu, ngay_gio_hen,                â”‚
â”‚         trang_thai, nguoi_tao_lich)                                    â”‚
â”‚        VALUES (?, ?, ?, ?, 'cho_xac_nhan', 'benh_nhan')"               â”‚
â”‚   );                                                                    â”‚
â”‚   $stmt->execute([$user_id, $id_bacsi, $id_dichvu, $final_datetime]);  â”‚
â”‚                                                                         â”‚
â”‚   // 6. Gá»­i email                                                      â”‚
â”‚   sendNewAccountInfo($email, $fullname, $phone, $rand_pass);           â”‚
â”‚                                                                         â”‚
â”‚   $conn->commit();                                                      â”‚
â”‚   alert("Äáº·t lá»‹ch thÃ nh cÃ´ng!");                                       â”‚
â”‚                                                                         â”‚
â”‚ â†’ Validate dá»¯ liá»‡u                                                      â”‚
â”‚ â†’ Táº¡o tÃ i khoáº£n + lá»‹ch háº¹n trong transaction                           â”‚
â”‚ â†’ Gá»­i email thÃ´ng bÃ¡o                                                   â”‚
â”‚ â†’ Redirect vá» trang chá»§                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BÆ¯á»šC 8: Gá»¬I EMAIL (send_mail.php - PHPMailer)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Code:                                                                   â”‚
â”‚   function sendNewAccountInfo($email, $name, $phone, $pass) {          â”‚
â”‚       $body = "                                                         â”‚
â”‚           <h3>Xin chÃ o $name,</h3>                                      â”‚
â”‚           <p>ThÃ´ng tin tÃ i khoáº£n:</p>                                   â”‚
â”‚           <ul>                                                          â”‚
â”‚               <li>TÃªn Ä‘Äƒng nháº­p: $phone</li>                            â”‚
â”‚               <li>Máº­t kháº©u: $pass</li>                                  â”‚
â”‚           </ul>                                                         â”‚
â”‚       ";                                                                â”‚
â”‚       return sendMailGeneric($email, "ThÃ´ng tin tÃ i khoáº£n", $body);    â”‚
â”‚   }                                                                     â”‚
â”‚                                                                         â”‚
â”‚ â†’ Sá»­ dá»¥ng PHPMailer gá»­i qua SMTP Gmail                                 â”‚
â”‚ â†’ Gá»­i thÃ´ng tin tÃ i khoáº£n + máº­t kháº©u cho user                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
                        3 TRÆ¯á»œNG Há»¢P Xá»¬ LÃ CHÃNH
================================================================================

1ï¸âƒ£ BÃC SÄ¨ NGHá»ˆ PHÃ‰P
   API response: {"status": "on_leave"}
   â†’ Alert Ä‘á»: "BÃ¡c sÄ© Ä‘Ã£ nghá»‰ ngÃ y nÃ y"
   â†’ KHÃ”NG cho phÃ©p Ä‘áº·t lá»‹ch
   â†’ Dropdown Ca: Disabled
   â†’ NÃºt Submit: Disabled

2ï¸âƒ£ CÃ“ Lá»ŠCH LÃ€M VIá»†C
   API response: {"status": "has_schedule", "shifts": [...]}
   â†’ Hiá»ƒn thá»‹ Ä‘Ãºng ca bÃ¡c sÄ© lÃ m viá»‡c
   â†’ TÃ­nh giá» chÃ­nh xÃ¡c (Queue System)
   â†’ Tráº¡ng thÃ¡i: "cho_xac_nhan"
   â†’ User cÃ³ thá»ƒ submit

3ï¸âƒ£ KHÃ”NG CÃ“ Lá»ŠCH LÃ€M VIá»†C
   API response: {"status": "no_schedule"}
   â†’ Alert vÃ ng: "BÃ¡c sÄ© chÆ°a cÃ³ lá»‹ch, váº«n Ä‘áº·t Ä‘Æ°á»£c"
   â†’ Hiá»ƒn thá»‹ 2 ca dá»± kiáº¿n: SÃ¡ng (08:00) / Chiá»u (13:00)
   â†’ Giá» háº¹n táº¡m thá»i, chá» Admin duyá»‡t
   â†’ User váº«n cÃ³ thá»ƒ submit

================================================================================
                        DATABASE ÄÆ¯á»¢C Sá»¬ Dá»¤NG
================================================================================

dichvu       â†’ Láº¥y danh sÃ¡ch dá»‹ch vá»¥ (SELECT)
bacsi        â†’ Láº¥y danh sÃ¡ch bÃ¡c sÄ© (SELECT)
lichlamviec  â†’ Kiá»ƒm tra ca trá»±c cá»§a bÃ¡c sÄ© (SELECT)
yeucaunghi   â†’ Kiá»ƒm tra nghá»‰ phÃ©p (SELECT)
benhnhan     â†’ Táº¡o tÃ i khoáº£n má»›i (INSERT)
lichhen      â†’ Táº¡o lá»‹ch háº¹n (INSERT)

================================================================================
                        ÄIá»‚M Ná»”I Báº¬T
================================================================================

âœ“ KhÃ´ng cáº§n Ä‘Äƒng nháº­p trÆ°á»›c - Tá»± Ä‘á»™ng táº¡o tÃ i khoáº£n
âœ“ Kiá»ƒm tra lá»‹ch real-time qua AJAX - KhÃ´ng reload page
âœ“ Linh hoáº¡t - Cho phÃ©p Ä‘áº·t cáº£ khi bÃ¡c sÄ© chÆ°a cÃ³ lá»‹ch
âœ“ Queue System - TÃ­nh giá» khÃ¡m chÃ­nh xÃ¡c, trÃ¡nh trÃ¹ng láº·p
âœ“ Email notification - Gá»­i thÃ´ng tin tÃ i khoáº£n tá»± Ä‘á»™ng

================================================================================
                        SÆ  Äá»’ TÃ“M Táº®T
================================================================================

User vÃ o datlich.php
    â†“
Chá»n BÃ¡c sÄ© â†’ Má»Ÿ khÃ³a chá»n NgÃ y
    â†“
Chá»n NgÃ y â†’ AJAX call get_shifts_by_date.php
    â†“
Nháº­n JSON â†’ Hiá»ƒn thá»‹ Ca phÃ¹ há»£p
    â†“
Chá»n Ca + Äiá»n thÃ´ng tin â†’ Submit
    â†“
book_appointment.php:
  â”œâ”€ Validate dá»¯ liá»‡u
  â”œâ”€ Check nghá»‰ phÃ©p
  â”œâ”€ Check lá»‹ch lÃ m viá»‡c
  â”œâ”€ Táº¡o tÃ i khoáº£n (benhnhan)
  â”œâ”€ Táº¡o lá»‹ch háº¹n (lichhen)
  â””â”€ Gá»­i email (send_mail.php)
    â†“
HOÃ€N Táº¤T âœ“

================================================================================
