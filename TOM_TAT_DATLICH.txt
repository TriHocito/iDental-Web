

================================================================================
         PHáº¦N Bá»” SUNG: CHá»¨C NÄ‚NG ÄÄ‚NG KÃ & XÃC THá»°C OTP QUA EMAIL
================================================================================

ğŸ“ FILES LIÃŠN QUAN:
   â”œâ”€ views/dangky.php          â†’ Form Ä‘Äƒng kÃ½
   â”œâ”€ controllers/auth_register.php â†’ Xá»­ lÃ½ Ä‘Äƒng kÃ½ + Gá»­i OTP
   â”œâ”€ views/verify_otp.php      â†’ Trang nháº­p OTP
   â””â”€ includes/send_mail.php    â†’ Module gá»­i email (PHPMailer)

================================================================================
                    LUá»’NG ÄÄ‚NG KÃ TÃ€I KHOáº¢N Vá»šI XÃC THá»°C OTP
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BÆ¯á»šC 1: USER TRUY Cáº¬P TRANG ÄÄ‚NG KÃ (views/dangky.php)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Hiá»ƒn thá»‹ form vá»›i cÃ¡c trÆ°á»ng:                                            â”‚
â”‚   - Há» vÃ  tÃªn (fullname)                                                   â”‚
â”‚   - Sá»‘ Ä‘iá»‡n thoáº¡i (phone)                                                  â”‚
â”‚   - Email (email)                                                          â”‚
â”‚   - Máº­t kháº©u (password)                                                    â”‚
â”‚   - Nháº­p láº¡i máº­t kháº©u (confirm_password)                                   â”‚
â”‚ â€¢ User Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin                                               â”‚
â”‚ â€¢ Click nÃºt "ÄÄƒng KÃ½"                                                      â”‚
â”‚ â€¢ Form POST Ä‘áº¿n: controllers/auth_register.php                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BÆ¯á»šC 2: Xá»¬ LÃ ÄÄ‚NG KÃ (controllers/auth_register.php)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ A. KIá»‚M TRA Dá»® LIá»†U                                                        â”‚
â”‚    â”œâ”€ Máº­t kháº©u nháº­p láº¡i cÃ³ khá»›p khÃ´ng?                                     â”‚
â”‚    â”‚  â””â”€ KHÃ”NG â†’ Alert lá»—i, quay láº¡i form                                  â”‚
â”‚    â”œâ”€ Sá»‘ Ä‘iá»‡n thoáº¡i Ä‘Ã£ tá»“n táº¡i chÆ°a?                                       â”‚
â”‚    â”‚  â””â”€ CÃ“ â†’ Alert "SÄT Ä‘Ã£ Ä‘Äƒng kÃ½", quay láº¡i                             â”‚
â”‚    â””â”€ Táº¤T Cáº¢ OK â†’ Tiáº¿p tá»¥c bÆ°á»›c B                                          â”‚
â”‚                                                                             â”‚
â”‚ B. Táº O MÃƒ OTP & HASH Máº¬T KHáº¨U                                              â”‚
â”‚    â”œâ”€ Táº¡o OTP ngáº«u nhiÃªn 6 chá»¯ sá»‘:                                         â”‚
â”‚    â”‚  $otp = rand(100000, 999999);                                         â”‚
â”‚    â”œâ”€ Hash máº­t kháº©u:                                                       â”‚
â”‚    â”‚  $pass_hash = password_hash($pass, PASSWORD_DEFAULT);                 â”‚
â”‚    â””â”€ Chuáº©n bá»‹ dá»¯ liá»‡u Ä‘á»ƒ lÆ°u SESSION                                      â”‚
â”‚                                                                             â”‚
â”‚ C. Gá»¬I EMAIL OTP (Gá»i hÃ m sendOTP() tá»« send_mail.php)                      â”‚
â”‚    â”œâ”€ Gá»­i email Ä‘áº¿n Ä‘á»‹a chá»‰ user vá»«a nháº­p                                  â”‚
â”‚    â”œâ”€ Ná»™i dung email:                                                      â”‚
â”‚    â”‚  â€¢ TiÃªu Ä‘á»: "MÃ£ xÃ¡c thá»±c Ä‘Äƒng kÃ½ tÃ i khoáº£n - iDental"                 â”‚
â”‚    â”‚  â€¢ Body HTML: Hiá»ƒn thá»‹ mÃ£ OTP 6 sá»‘                                    â”‚
â”‚    â”‚  â€¢ ThÃ´ng bÃ¡o: "MÃ£ cÃ³ hiá»‡u lá»±c trong 5 phÃºt"                           â”‚
â”‚    â””â”€ Káº¿t quáº£:                                                             â”‚
â”‚       â”œâ”€ THÃ€NH CÃ”NG â†’ Tiáº¿p tá»¥c bÆ°á»›c D                                      â”‚
â”‚       â””â”€ THáº¤T Báº I â†’ Alert lá»—i, quay láº¡i form                               â”‚
â”‚                                                                             â”‚
â”‚ D. LÆ¯U THÃ”NG TIN Táº M VÃ€O SESSION (CHÆ¯A INSERT DATABASE)                    â”‚
â”‚    $_SESSION['temp_register'] = [                                          â”‚
â”‚       'sdt' => $phone,                                                     â”‚
â”‚       'mat_khau_hash' => $pass_hash,                                       â”‚
â”‚       'ten_day_du' => $fullname,                                           â”‚
â”‚       'email' => $email,                                                   â”‚
â”‚       'otp_code' => $otp,           â† LÆ°u mÃ£ Ä‘á»ƒ so sÃ¡nh sau               â”‚
â”‚       'otp_time' => time()          â† LÆ°u timestamp Ä‘á»ƒ check háº¿t háº¡n      â”‚
â”‚    ];                                                                      â”‚
â”‚                                                                             â”‚
â”‚ E. CHUYá»‚N HÆ¯á»šNG Äáº¾N TRANG XÃC THá»°C                                         â”‚
â”‚    header("Location: ../views/verify_otp.php");                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BÆ¯á»šC 3: TRANG NHáº¬P OTP (views/verify_otp.php)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Kiá»ƒm tra SESSION:                                                        â”‚
â”‚   â””â”€ Náº¿u KHÃ”NG cÃ³ $_SESSION['temp_register']                               â”‚
â”‚      â†’ Redirect vá» dangky.php (NgÆ°á»i dÃ¹ng truy cáº­p trá»±c tiáº¿p)             â”‚
â”‚                                                                             â”‚
â”‚ â€¢ Hiá»ƒn thá»‹ form nháº­p OTP:                                                  â”‚
â”‚   - Input 6 chá»¯ sá»‘ (pattern="\d{6}")                                       â”‚
â”‚   - Hiá»ƒn thá»‹ email Ä‘Ã£ gá»­i: $stored_data['email']                           â”‚
â”‚   - NÃºt "XÃ¡c Nháº­n ÄÄƒng KÃ½"                                                 â”‚
â”‚   - Link "Gá»­i láº¡i mÃ£" (auth_register.php?resend=1)                         â”‚
â”‚                                                                             â”‚
â”‚ â€¢ User nháº­p mÃ£ OTP                                                         â”‚
â”‚ â€¢ Click "XÃ¡c Nháº­n ÄÄƒng KÃ½"                                                 â”‚
â”‚ â€¢ Form POST vá» chÃ­nh trang nÃ y (verify_otp.php)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BÆ¯á»šC 4: XÃC THá»°C OTP (verify_otp.php - Xá»­ lÃ½ POST)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ A. KIá»‚M TRA THá»œI GIAN (OTP cÃ³ hiá»‡u lá»±c 15 phÃºt = 900 giÃ¢y)                â”‚
â”‚    if (time() - $stored_data['otp_time'] > 900) {                          â”‚
â”‚       â†’ BÃ¡o lá»—i: "MÃ£ OTP Ä‘Ã£ háº¿t háº¡n. Vui lÃ²ng gá»­i láº¡i."                    â”‚
â”‚    }                                                                       â”‚
â”‚                                                                             â”‚
â”‚ B. SO SÃNH MÃƒ OTP                                                          â”‚
â”‚    if ($user_otp == $stored_data['otp_code']) {                            â”‚
â”‚       â†’ ÄÃšNG: Tiáº¿p tá»¥c bÆ°á»›c C                                              â”‚
â”‚    } else {                                                                â”‚
â”‚       â†’ SAI: BÃ¡o lá»—i "MÃ£ xÃ¡c thá»±c khÃ´ng chÃ­nh xÃ¡c!"                        â”‚
â”‚    }                                                                       â”‚
â”‚                                                                             â”‚
â”‚ C. INSERT VÃ€O DATABASE (ChÃ­nh thá»©c táº¡o tÃ i khoáº£n)                          â”‚
â”‚    INSERT INTO benhnhan (sdt, mat_khau_hash, ten_day_du, email)            â”‚
â”‚    VALUES (?, ?, ?, ?)                                                     â”‚
â”‚                                                                             â”‚
â”‚    Káº¿t quáº£:                                                                â”‚
â”‚    â”œâ”€ THÃ€NH CÃ”NG:                                                          â”‚
â”‚    â”‚  â€¢ unset($_SESSION['temp_register']) â† XÃ³a session táº¡m                â”‚
â”‚    â”‚  â€¢ Alert: "ÄÄƒng kÃ½ thÃ nh cÃ´ng! Vui lÃ²ng Ä‘Äƒng nháº­p."                   â”‚
â”‚    â”‚  â€¢ Redirect â†’ dangnhap.php                                            â”‚
â”‚    â””â”€ THáº¤T Báº I (Email/SÄT trÃ¹ng):                                          â”‚
â”‚       â€¢ BÃ¡o lá»—i: "Email hoáº·c SÄT Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng"                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Káº¾T QUáº¢: User cÃ³ tÃ i khoáº£n má»›i â†’ CÃ³ thá»ƒ Ä‘Äƒng nháº­p vÃ o há»‡ thá»‘ng            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
                    TÃNH NÄ‚NG PHá»¤: Gá»¬I Láº I MÃƒ OTP
================================================================================

User click "Gá»­i láº¡i mÃ£" â†’ GET auth_register.php?resend=1

Xá»­ lÃ½:
â”œâ”€ Kiá»ƒm tra SESSION cÃ³ tá»“n táº¡i khÃ´ng
â”œâ”€ Táº¡o OTP má»›i: $new_otp = rand(100000, 999999)
â”œâ”€ Cáº­p nháº­t láº¡i SESSION:
â”‚  â€¢ $_SESSION['temp_register']['otp_code'] = $new_otp
â”‚  â€¢ $_SESSION['temp_register']['otp_time'] = time()  â† Reset thá»i gian
â”œâ”€ Gá»i sendOTP($email, $new_otp)
â””â”€ Redirect láº¡i verify_otp.php vá»›i thÃ´ng bÃ¡o "MÃ£ má»›i Ä‘Ã£ Ä‘Æ°á»£c gá»­i"

================================================================================
                    MODULE Gá»¬I EMAIL (includes/send_mail.php)
================================================================================

Sá»­ dá»¥ng thÆ° viá»‡n: PHPMailer (Composer)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ function sendMailGeneric($toEmail, $subject, $bodyContent)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ HÃ m gá»‘c Ä‘á»ƒ gá»­i email                                       â”‚
â”‚ â€¢ Cáº¥u hÃ¬nh SMTP:                                             â”‚
â”‚   - Host: smtp.gmail.com                                     â”‚
â”‚   - Port: 587                                                â”‚
â”‚   - Username: tranhaitri92@gmail.com                         â”‚
â”‚   - Password: App Password (bhcs ojsn jmjq ddpb)             â”‚
â”‚ â€¢ Return: true/false                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ function sendOTP($toEmail, $otpCode)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Gá»i sendMailGeneric() vá»›i ná»™i dung HTML Ä‘áº·c biá»‡t           â”‚
â”‚ â€¢ Template email:                                            â”‚
â”‚   <h1>$otpCode</h1> (6 chá»¯ sá»‘, mÃ u xanh, font to)            â”‚
â”‚   "MÃ£ cÃ³ hiá»‡u lá»±c trong 5 phÃºt"                              â”‚
â”‚ â€¢ Subject: "MÃ£ xÃ¡c thá»±c Ä‘Äƒng kÃ½ tÃ i khoáº£n - iDental"         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ function sendNewAccountInfo($toEmail, $name, $phone, $pass)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ DÃ¹ng cho chá»©c nÄƒng Äáº¶T Lá»ŠCH KHÃ”NG Cáº¦N ÄÄ‚NG KÃ             â”‚
â”‚ â€¢ Gá»­i thÃ´ng tin tÃ i khoáº£n tá»± Ä‘á»™ng táº¡o                        â”‚
â”‚ â€¢ Ná»™i dung: Username (SÄT) + Máº­t kháº©u ngáº«u nhiÃªn             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ function sendAppointmentConfirmation(...)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Gá»­i khi lá»‹ch háº¹n Ä‘Æ°á»£c xÃ¡c nháº­n                             â”‚
â”‚ â€¢ Ná»™i dung: Thá»i gian, Dá»‹ch vá»¥, BÃ¡c sÄ©, Äá»‹a chá»‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
                    TÃ“M Táº®T WORKFLOW ÄÄ‚NG KÃ Vá»šI OTP
================================================================================

dangky.php (Form)
    â†“ [POST]
auth_register.php (Validate + Generate OTP + Send Email)
    â†“ [SESSION + Redirect]
verify_otp.php (Nháº­p OTP)
    â†“ [POST + Verify]
auth_register.php (Insert Database)
    â†“ [Success]
dangnhap.php (ÄÄƒng nháº­p)

================================================================================
                    ÄIá»‚M Äáº¶C BIá»†T Cá»¦A Há»† THá»NG OTP
================================================================================

âœ“ Báº¢O Máº¬T
  â€¢ Máº­t kháº©u Ä‘Æ°á»£c hash trÆ°á»›c khi lÆ°u SESSION
  â€¢ OTP cÃ³ thá»i háº¡n 15 phÃºt (900 giÃ¢y)
  â€¢ Session chá»‰ lÆ°u táº¡m, chÆ°a insert database

âœ“ USER EXPERIENCE
  â€¢ CÃ³ thá»ƒ gá»­i láº¡i mÃ£ náº¿u khÃ´ng nháº­n Ä‘Æ°á»£c
  â€¢ ThÃ´ng bÃ¡o rÃµ rÃ ng khi OTP háº¿t háº¡n
  â€¢ Hiá»ƒn thá»‹ email Ä‘Ã£ gá»­i Ä‘á»ƒ user kiá»ƒm tra

âœ“ PHÃ’NG CHá»NG SPAM
  â€¢ Má»—i láº§n gá»­i láº¡i sáº½ táº¡o OTP má»›i
  â€¢ Reset láº¡i thá»i gian hiá»‡u lá»±c
  â€¢ Email cÅ© trá»Ÿ nÃªn vÃ´ hiá»‡u

âœ“ DATABASE INTEGRITY
  â€¢ Chá»‰ INSERT khi OTP Ä‘Ãºng
  â€¢ TrÃ¡nh tÃ i khoáº£n rÃ¡c (email giáº£)
  â€¢ Äáº£m báº£o user sá»Ÿ há»¯u email

================================================================================
                    CÃC TRÆ¯á»œNG Há»¢P EDGE CASE
================================================================================

1. User nháº­p sai OTP 3 láº§n
   â†’ Hiá»‡n táº¡i: KhÃ´ng giá»›i háº¡n, cÃ³ thá»ƒ nháº­p mÃ£i
   â†’ Khuyáº¿n nghá»‹: ThÃªm giá»›i háº¡n retry

2. User truy cáº­p trá»±c tiáº¿p verify_otp.php
   â†’ Há»‡ thá»‘ng check SESSION, redirect vá» dangky.php

3. User Ä‘Äƒng kÃ½ xong nhÆ°ng khÃ´ng verify
   â†’ Session sáº½ máº¥t khi Ä‘Ã³ng trÃ¬nh duyá»‡t
   â†’ KhÃ´ng táº¡o tÃ i khoáº£n rÃ¡c trong database

4. Email khÃ´ng gá»­i Ä‘Æ°á»£c (SMTP lá»—i)
   â†’ Alert lá»—i, user quay láº¡i form Ä‘Äƒng kÃ½

5. OTP háº¿t háº¡n (> 15 phÃºt)
   â†’ Hiá»ƒn thá»‹ thÃ´ng bÃ¡o, yÃªu cáº§u "Gá»­i láº¡i mÃ£"

================================================================================
                    SO SÃNH 2 CÃCH ÄÄ‚NG KÃ
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ÄÄ‚NG KÃ THÃ”NG THÆ¯á»œNG (dangky.php) â”‚ Äáº¶T Lá»ŠCH KHÃ”NG Cáº¦N ÄÄ‚NG KÃ          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ User chá»§ Ä‘á»™ng Ä‘Äƒng kÃ½            â”‚ â€¢ User Ä‘áº·t lá»‹ch trá»±c tiáº¿p           â”‚
â”‚ â€¢ Nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin            â”‚ â€¢ Há»‡ thá»‘ng tá»± táº¡o tÃ i khoáº£n         â”‚
â”‚ â€¢ XÃC THá»°C QUA OTP (Email)         â”‚ â€¢ KHÃ”NG Cáº¦N XÃC THá»°C OTP            â”‚
â”‚ â€¢ Tá»± chá»n máº­t kháº©u                 â”‚ â€¢ Máº­t kháº©u random, gá»­i qua email    â”‚
â”‚ â€¢ Insert sau khi verify            â”‚ â€¢ Insert ngay láº­p tá»©c               â”‚
â”‚ â€¢ Tráº¡ng thÃ¡i: Verified             â”‚ â€¢ Tráº¡ng thÃ¡i: ChÆ°a verified         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
